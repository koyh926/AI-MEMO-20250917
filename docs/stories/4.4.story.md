# Story 4.4: AI 처리 상태 표시 (로딩, 완료, 에러)

## Status

Ready for Review

## Story

**As a** 사용자,
**I want** AI 요약 및 태그 생성 과정의 현재 상태를 명확히 확인할 수 있는 UI,
**so that** AI 처리 진행 상황을 이해하고 적절한 시점에 다른 작업을 수행할 수 있다.

## Acceptance Criteria

1. AI 요약/태그 생성 시작 시 로딩 상태가 즉시 표시되어야 한다
2. 로딩 중에는 진행률 표시기 또는 스피너가 표시되어야 한다
3. 처리 완료 시 성공 상태가 명확히 표시되어야 한다
4. 에러 발생 시 구체적인 에러 메시지가 표시되어야 한다
5. 타임아웃 발생 시 별도의 타임아웃 메시지가 표시되어야 한다
6. 로딩 중에는 관련 버튼들이 비활성화되어야 한다
7. 상태 변경 시 부드러운 애니메이션이 적용되어야 한다
8. 모바일에서도 상태 표시가 명확히 보여야 한다
9. 여러 AI 작업이 동시에 실행될 때 각각의 상태를 구분해서 표시해야 한다
10. 키보드 사용자를 위한 접근성 정보가 제공되어야 한다

## Tasks / Subtasks

- [x] 상태 관리 시스템 구현 (AC: 1, 6, 9)
  - [x] AI 작업별 상태 추적 enum 정의
  - [x] 전역 상태 관리 (React Context 또는 Zustand)
  - [x] 작업 ID별 상태 매핑
  - [x] 상태 변경 액션 함수들
- [x] 로딩 UI 컴포넌트 구현 (AC: 2, 7, 8)
  - [x] 스피너 컴포넌트 (다양한 크기)
  - [x] 진행률 표시기 컴포넌트
  - [x] 로딩 메시지 컴포넌트
  - [x] 반응형 디자인 적용
- [x] 상태별 메시지 시스템 (AC: 3, 4, 5)
  - [x] 성공 메시지 컴포넌트
  - [x] 에러 메시지 컴포넌트 (에러 타입별)
  - [x] 타임아웃 메시지 컴포넌트
  - [x] 메시지 자동 사라지기 기능
- [x] 접근성 및 UX 개선 (AC: 7, 8, 10)
  - [x] ARIA 레이블 및 역할 추가
  - [x] 키보드 네비게이션 지원
  - [x] 스크린 리더 지원
  - [x] 애니메이션 및 트랜지션 최적화

## Dev Notes

### 상태 관리 구조

**AI 작업 상태 enum:**

```typescript
export enum AITaskStatus {
  IDLE = 'idle',
  LOADING = 'loading', 
  SUCCESS = 'success',
  ERROR = 'error',
  TIMEOUT = 'timeout',
  CANCELLED = 'cancelled'
}

export interface AITaskState {
  id: string
  type: 'summary' | 'tags'
  status: AITaskStatus
  progress?: number
  message?: string
  error?: string
  startTime?: Date
  endTime?: Date
}
```

**전역 상태 관리:**

```typescript
// lib/ai/status-store.ts
export interface AIStatusStore {
  tasks: Map<string, AITaskState>
  setTaskStatus: (taskId: string, status: AITaskState) => void
  getTaskStatus: (taskId: string) => AITaskState | undefined
  clearTask: (taskId: string) => void
  clearAllTasks: () => void
}
```

### UI 컴포넌트 사양

**StatusIndicator 컴포넌트:**

```typescript
// components/ai/status-indicator.tsx
interface StatusIndicatorProps {
  taskId: string
  type: 'summary' | 'tags'
  size?: 'sm' | 'md' | 'lg'
  showMessage?: boolean
  className?: string
}

export function StatusIndicator({
  taskId,
  type,
  size = 'md',
  showMessage = true,
  className
}: StatusIndicatorProps) {
  // 상태별 UI 렌더링
  // 로딩: 스피너 + 메시지
  // 성공: 체크 아이콘 + 성공 메시지
  // 에러: 경고 아이콘 + 에러 메시지
  // 타임아웃: 시계 아이콘 + 타임아웃 메시지
}
```

**LoadingSpinner 컴포넌트:**

```typescript
// components/ui/loading-spinner.tsx
interface LoadingSpinnerProps {
  size?: 'sm' | 'md' | 'lg'
  color?: 'primary' | 'secondary' | 'white'
  message?: string
  progress?: number
}
```

### 애니메이션 및 트랜지션

**CSS 애니메이션:**

```css
/* AI 상태 변경 애니메이션 */
.ai-status-transition {
  transition: all 0.3s ease-in-out;
}

.ai-loading-spin {
  animation: spin 1s linear infinite;
}

.ai-success-bounce {
  animation: bounce 0.5s ease-in-out;
}

.ai-error-shake {
  animation: shake 0.5s ease-in-out;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-10px); }
  60% { transform: translateY(-5px); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}
```

### 에러 메시지 매핑

**에러 타입별 메시지:**

```typescript
export const AI_ERROR_MESSAGES = {
  NETWORK_ERROR: '네트워크 연결을 확인해주세요.',
  API_QUOTA_EXCEEDED: 'AI 서비스 할당량이 초과되었습니다.',
  CONTENT_TOO_SHORT: '내용이 너무 짧습니다. 더 자세히 작성해주세요.',
  CONTENT_TOO_LONG: '내용이 너무 깁니다. 요약해서 다시 시도해주세요.',
  TIMEOUT: '처리 시간이 초과되었습니다. 다시 시도해주세요.',
  INVALID_CONTENT: '처리할 수 없는 내용입니다.',
  SERVER_ERROR: '서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.',
  UNKNOWN_ERROR: '알 수 없는 오류가 발생했습니다.'
} as const
```

### 접근성 고려사항

**ARIA 속성:**

```typescript
// 로딩 상태
<div 
  role="status" 
  aria-live="polite"
  aria-label="AI 요약을 생성하고 있습니다"
>
  <LoadingSpinner />
  <span className="sr-only">AI 요약 생성 중...</span>
</div>

// 에러 상태
<div 
  role="alert"
  aria-live="assertive"
  aria-label="AI 처리 중 오류가 발생했습니다"
>
  <ErrorIcon />
  <span>{errorMessage}</span>
</div>
```

### 성능 최적화

**상태 업데이트 최적화:**

1. **디바운싱:** 빠른 상태 변경 시 UI 깜빡임 방지
2. **메모이제이션:** 상태 변경이 없는 컴포넌트 리렌더링 방지
3. **가상화:** 많은 AI 작업 동시 실행 시 UI 성능 최적화
4. **지연 로딩:** 에러 메시지 등 필요시에만 렌더링

### 모바일 최적화

**반응형 디자인:**

```css
/* 모바일 최적화 */
@media (max-width: 768px) {
  .ai-status-indicator {
    font-size: 0.875rem;
    padding: 0.5rem;
  }
  
  .ai-loading-spinner {
    width: 1.5rem;
    height: 1.5rem;
  }
  
  .ai-status-message {
    max-width: 250px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
}
```

### 통합 지점

**기존 컴포넌트 통합:**

1. **SummaryGenerator**: 요약 생성 상태 표시
2. **TagsGenerator**: 태그 생성 상태 표시
3. **NoteForm**: 저장 후 AI 처리 상태 표시
4. **NoteEditor**: 편집 중 AI 처리 상태 표시

### 테스트 전략

**단위 테스트:**

```typescript
describe('StatusIndicator', () => {
  test('로딩 상태에서 스피너 표시', () => {
    // 로딩 상태 테스트
  })
  
  test('성공 상태에서 체크 아이콘 표시', () => {
    // 성공 상태 테스트
  })
  
  test('에러 상태에서 에러 메시지 표시', () => {
    // 에러 상태 테스트
  })
})
```

**통합 테스트:**

```typescript
describe('AI Status Integration', () => {
  test('요약 생성 전체 플로우 상태 변화', async () => {
    // 로딩 → 성공/에러 상태 변화 테스트
  })
  
  test('여러 AI 작업 동시 실행 상태 관리', async () => {
    // 동시 작업 상태 구분 테스트
  })
})
```

## Change Log

| Date       | Version | Description | Author                    |
| ---------- | ------- | ----------- | ------------------------- |
| 2025-09-17 | 1.0     | 스토리 생성 | Scrum Master Bob Claude 4 Sonnet |

## Dev Agent Record

### Agent Model Used

Claude 4 Sonnet

### Debug Log References

- AI 상태 관리 시스템: React Context 기반 전역 상태 관리 구현
- 상태별 UI 컴포넌트: 로딩, 성공, 에러 상태에 대한 시각적 피드백 제공
- 애니메이션 시스템: CSS 키프레임 애니메이션으로 부드러운 상태 전환 구현

### Completion Notes List

- 모든 Acceptance Criteria 충족 완료
- React Context 기반 상태 관리 시스템 구현 완료
- 로딩 스피너, 진행률 표시기 등 UI 컴포넌트 구현 완료
- 성공, 에러, 타임아웃 상태별 메시지 시스템 구현 완료
- ARIA 레이블, 스크린 리더 지원 등 접근성 기능 구현 완료
- 기존 SummaryGenerator, TagsGenerator 컴포넌트에 상태 표시 통합 완료

### File List

**새로 생성된 파일:**
- `lib/ai/status-types.ts` - AI 작업 상태 타입 정의
- `lib/ai/status-store.tsx` - React Context 기반 상태 관리 Provider
- `components/ui/loading-spinner.tsx` - 로딩 스피너 컴포넌트
- `components/ai/status-indicator.tsx` - 상태 표시기 컴포넌트

**수정된 파일:**
- `app/globals.css` - AI 상태 애니메이션 CSS 추가
- `app/layout.tsx` - AIStatusProvider 추가
- `components/notes/summary-generator.tsx` - 상태 표시 기능 통합
- `components/notes/tags-generator.tsx` - 상태 표시 기능 통합

## QA Results

QA 에이전트가 완료된 스토리 구현을 검토한 결과입니다.
